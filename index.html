
<html>
<head>
	<title>おさかな</title>
<style>
	td {
		font-size: 14px;
	}
	.bg {
		/*位置の設定*/
		width: 100%;
		height: 100%;
		position: fixed;
		top: 0;
		left: 0;

		/*背景画像の設定*/
		background: url(umi_kani.png) bottom right no-repeat;  

		/*透過の設定*/
		opacity: 0.1;
		z-index: -1;
		background-size: 50%;
	}
</style>
<script type="text/javascript" src="weather.js"></script>
<script type="text/javascript" src="osakana.js"></script>
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script type="text/javascript">
var displayWeather = function() {
   $("#weatherDiv").text(WeatherFinder.getWeather(new Date(), $("#zoneSelect").val()));
}

function findWeather() {
   $("#weatherDiv").text('');
   $("#weatherTableHeaderRow ~ tr").remove()
   var weatherStartTime = WeatherFinder.getWeatherTimeFloor(new Date()).getTime();
   var weatherStartHour = WeatherFinder.getEorzeaHour(weatherStartTime);
   var zone = $("#zoneSelect").val();
   var targetWeather = $("#weatherSelect").val();
   var targetPrevWeather = $("#previousWeatherSelect").val();
   var tries = 0;
   var matches = 0;
   var weather = WeatherFinder.getWeather(weatherStartTime, zone);
   var prevWeather = WeatherFinder.getWeather(weatherStartTime-1, zone);
   while (tries < 1000 && matches < 5) {
      var weatherMatch = targetWeather == null;
      var prevWeatherMatch = targetPrevWeather == null;
      var timeMatch = false;
      for (var i in targetWeather) {
         if (targetWeather[i] == "" || targetWeather[i] == weather) {
            weatherMatch = true;
            break;
         }
      }
      for (var i in targetPrevWeather) {
         if (targetPrevWeather[i] == "" || targetPrevWeather[i] == prevWeather) {
            prevWeatherMatch = true;
         }
      }
      if ($("#timeBox" + weatherStartHour).is(":checked")) {
         timeMatch = true;
      }
      if (weatherMatch && prevWeatherMatch && timeMatch) {
         var weatherDate = new Date(weatherStartTime);
         $("#weatherTable").append('<tr><td>' + prevWeather + '</td><td>' + weather + '</td><td>' + weatherStartHour + ':00</td><td>' + weatherDate + '</td></tr>');
         matches++;
      }
      weatherStartTime += 8 * 175 * 1000; // Increment by 8 Eorzean hours
      weatherStartHour = WeatherFinder.getEorzeaHour(weatherStartTime);
      prevWeather = weather;
      weather = WeatherFinder.getWeather(weatherStartTime, zone);
      tries++;
   }
   if (matches == 0) {
      $("#weatherDiv").append("Couldn't find the desired conditions over the next 1000 weather cycles (~16 Earth days).  Make sure you have selected at least one time period.<br/>");
   }
}

function populateWeather() {
   var weathers = WeatherFinder.weatherLists[$("#zoneSelect").val()];
   var selects = $("#weatherSelect").add("#previousWeatherSelect");
   selects.empty();
   selects.append('<option value="" selected="selected">Any</option>');
   for (var w in weathers) {
      selects.append('<option value="' + weathers[w] + '">' + weathers[w] + '</option>');
   }
}
   
$(function() {   
   for (var i = 0; i < osakanas.length; i++) {
      var osakana = osakanas[i];
      
      var time = "";
      if (osakana.From != "") {
         time = ("0" + osakana.From).slice(-2) + ":00-" + ("0" + osakana.To).slice(-2) + ":00";
      }
      
      var weather = "";      
      if (osakana.Previous_Weather != "" && osakana.Weather != "") {
         /* 移ろいﾌｨｯｼｭ */
         weather = osakana.Previous_Weather + " → " + osakana.Weather;
      } else if (osakana.Weather != "") {         
         /* 移ろわないﾌｨｯｼｭ */
         weather = osakana.Weather;
      } else if (osakana.Previous_Weather != "") {         
         /* 移ろいじゃないけど前天候に依存するﾌｨｯｼｭ。ステタカントゥス、お前のことだ！ */
         weather = osakana.Previous_Weather + " → なんでも";
      }
	  
	  /* おさかなチャンス 2個 */
	  var chances = getFishChance(2, osakana.Zone, osakana.Weather, osakana.Previous_Weather, osakana.From, osakana.To);
	  
      var html = '<tr>';
	  html += '<td>' + osakana.Fish + '</td>';
	  html += '<td>' + osakana.Spot + '</td>';
	  html += '<td>' + osakana.Zone + '</td>';
	  html += '<td>' + time + '</td>';
	  html += '<td>' + weather + '</td>';
	  html += '<td>' + chances[0] + '</td>';
	  html += '<td>' + chances[1] + '</td>';
	  // html += '<td>' + chances[2] + '</td>';
	  html += '</tr>'
      $("#osakana_list").append(html);   
   }
})
</script>
</head>
<body>
   <div class="bg"></div>
   <table id="osakana_list"></table>
<table>
<tr><td>Zone: </td><td><select id="zoneSelect" onchange="populateWeather()">
<option value="">Select a Zone</option>
<option value="Limsa Lominsa">Limsa Lominsa</option>
<option value="Middle La Noscea">Middle La Noscea</option>
<option value="Lower La Noscea">Lower La Noscea</option>
<option value="Eastern La Noscea">Eastern La Noscea</option>
<option value="Western La Noscea">Western La Noscea</option>
<option value="Upper La Noscea">Upper La Noscea</option>
<option value="Outer La Noscea">Outer La Noscea</option>
<option value="Mist">Mist</option>
<option value="Gridania">Gridania</option>
<option value="Central Shroud">Central Shroud</option>
<option value="East Shroud">East Shroud</option>
<option value="South Shroud">South Shroud</option>
<option value="North Shroud">North Shroud</option>
<option value="The Lavender Beds">The Lavender Beds</option>
<option value="Ul'dah">Ul'dah</option>
<option value="Western Thanalan">Western Thanalan</option>
<option value="Central Thanalan">Central Thanalan</option>
<option value="Eastern Thanalan">Eastern Thanalan</option>
<option value="Southern Thanalan">Southern Thanalan</option>
<option value="Northern Thanalan">Northern Thanalan</option>
<option value="The Goblet">The Goblet</option>
<option value="Mor Dhona">Mor Dhona</option>
<option value="Ishgard">Ishgard</option>
<option value="Coerthas Central Highlands">Coerthas Central Highlands</option>
<option value="Coerthas Western Highlands">Coerthas Western Highlands</option>
<option value="The Sea of Clouds">The Sea of Clouds</option>
<option value="Azys Lla">Azys Lla</option>
<option value="The Dravanian Forelands">The Dravanian Forelands</option>
<option value="The Dravanian Hinterlands">The Dravanian Hinterlands</option>
<option value="The Churning Mists">The Churning Mists</option>
<option value="Idyllshire">Idyllshire</option>
<option value="Rhalgr's Reach">Rhalgr's Reach</option>
<option value="The Fringes">The Fringes</option>
<option value="The Peaks">The Peaks</option>
<option value="The Lochs">The Lochs</option>
<option value="The Ruby Sea">The Ruby Sea</option>
<option value="Yanxia">Yanxia</option>
<option value="The Azim Steppe">The Azim Steppe</option>
<option value="Kugane">Kugane</option>
<option value="Eureka Anemos">Eureka Anemos</option>
<option value="Eureka Pagos">Eureka Pagos</option>
<option value="Eureka Pyros">Eureka Pyros</option>
<option value="Eureka Hydatos">Eureka Hydatos</option>
</select></td></tr>
<tr><td>Desired Weather: </td><td><select id="weatherSelect" multiple="true" size="7"><option value="">Any</option></select></td></tr>
<tr><td>Transition From: </td><td><select id="previousWeatherSelect" multiple="true" size="7"><option value="">Any</option></select><br/></td></tr>
<tr><td>Eorzea Time: </td><td><input type="checkbox" name="timeBox" value="0" id="timeBox0" checked="checked"/>00:00-07:59  <br/><input type="checkbox" name="timeBox" value="8" id="timeBox8" checked="checked"/>08:00-15:59  <br/><input type="checkbox" name="timeBox" value="16" id="timeBox16" checked="checked"/>16:00-23:59  <br/></td></tr>
</table>
<button onclick="findWeather()">Find Weather</button><br/>
<table id="weatherTable">
<tr id="weatherTableHeaderRow"><th>Previous Weather</th><th>Current Weather</th><th>Eorzea Time</th><th>Local Time</th></tr>
</table>
<div id="weatherDiv"></div>
<body>
</html>
